{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase/admin.ts"],"sourcesContent":["\nimport admin from 'firebase-admin';\nimport fs from 'fs';\nimport path from 'path';\n\n// Attempt to load service account credentials\n// Try environment variable first, then local file\n\nlet serviceAccountJson: string | null = null;\nlet initializedVia: string | null = null; // Keep track of how it was initialized\n\n// Method 1: Environment Variable (Recommended for deployment)\nif (process.env.FIREBASE_SERVICE_ACCOUNT_KEY) {\n  serviceAccountJson = process.env.FIREBASE_SERVICE_ACCOUNT_KEY;\n  initializedVia = 'environment variable';\n  console.log(\"Firebase Admin SDK: Attempting initialization via environment variable.\");\n} else {\n   console.log(\"Firebase Admin SDK: FIREBASE_SERVICE_ACCOUNT_KEY environment variable not found.\");\n}\n\n\n// Method 2: Local File (Easier for local dev, ensure it's gitignored)\nif (!serviceAccountJson) {\n   const serviceAccountPath = path.resolve('./serviceAccountKey.json'); // Use path.resolve for absolute path\n    console.log(`Firebase Admin SDK: Checking for local file at ${serviceAccountPath}...`);\n  try {\n    if (fs.existsSync(serviceAccountPath)) {\n      serviceAccountJson = fs.readFileSync(serviceAccountPath, 'utf8');\n      initializedVia = 'local file (serviceAccountKey.json)';\n       console.log(\"Firebase Admin SDK: Found and using local serviceAccountKey.json file.\");\n    } else {\n       console.log(\"Firebase Admin SDK: Local serviceAccountKey.json file not found.\");\n    }\n  } catch (error: any) {\n    console.error(`Firebase Admin SDK: Error reading local serviceAccountKey.json: ${error.message}`);\n    // Proceed without local file if reading fails\n    serviceAccountJson = null; // Ensure it's null if read failed\n  }\n}\n\n\n// Function to initialize Firebase Admin SDK\nconst initializeFirebaseAdmin = (): admin.auth.Auth | null => {\n  // Check if the SDK is already initialized to prevent re-initialization errors\n  if (admin.apps.length > 0) {\n    // console.log(\"Firebase Admin SDK already initialized.\"); // Reduce console noise\n    return admin.auth(); // Return existing auth instance\n  }\n\n  // Check if we found credentials\n  if (!serviceAccountJson) {\n     console.error(\"Firebase Admin SDK: Initialization failed - No service account credentials found (neither env var nor local file).\");\n     return null;\n  }\n\n   let serviceAccount;\n   try {\n        serviceAccount = JSON.parse(serviceAccountJson);\n        // Basic validation of parsed content\n        if (!serviceAccount.project_id || !serviceAccount.private_key || !serviceAccount.client_email) {\n            console.error(\"Firebase Admin SDK: Parsed service account JSON is missing required fields (project_id, private_key, client_email).\");\n            return null;\n        }\n   } catch (error: any) {\n       console.error(`Firebase Admin SDK: Failed to parse service account JSON from ${initializedVia}: ${error.message}`);\n       return null;\n   }\n\n\n  console.log(`Firebase Admin SDK: Attempting initialization via ${initializedVia}...`);\n  try {\n    admin.initializeApp({\n      credential: admin.credential.cert(serviceAccount),\n    });\n    console.log('Firebase Admin SDK Initialized successfully.'); // Simplified confirmation\n  } catch (error: any) {\n    // Catch potential errors during the admin.initializeApp call itself\n     console.error(`Firebase Admin SDK: Unexpected error during initialization via ${initializedVia}: ${error.message}`);\n     // Log the structure of the service account (excluding private key) for debugging if needed\n     // console.error(\"Service Account structure (check fields):\", { projectId: serviceAccount.project_id, clientEmail: serviceAccount.client_email });\n     return null; // Explicitly return null on initialization error\n  }\n\n  // --- Check Initialization Status ---\n  if (admin.apps.length > 0) {\n      // Remove the reference to the undefined variable 'initializedVia' here\n      console.log(`Firebase Admin SDK initialization confirmed.`);\n      return admin.auth();\n  }\n\n  // --- Initialization Failed (Should theoretically not be reached if above logic is sound) ---\n  console.error('CRITICAL: Firebase Admin SDK initialization failed after attempting credential loading.');\n  return null; // Indicate failure\n};\n\n// Initialize and attempt to get the adminAuth instance\nconst adminAuthInstance = initializeFirebaseAdmin();\n\n// Export the instance only if initialization was successful.\n// Throwing an error makes the initialization failure immediate and clear during server startup/request.\nif (!adminAuthInstance) {\n   // Ensure this error message clearly indicates the user needs to check configuration.\n   throw new Error(\"Firebase Admin SDK could not be initialized. Check server logs for details. Common causes are missing or invalid service account credentials (env var or local file). Please verify your setup according to the README.md.\");\n}\n\nexport const adminAuth = adminAuthInstance;\n// Export other admin services if needed, e.g., admin.firestore()\n\n"],"names":[],"mappings":";;;AACA;AACA;AACA;;;;AAEA,8CAA8C;AAC9C,kDAAkD;AAElD,IAAI,qBAAoC;AACxC,IAAI,iBAAgC,MAAM,uCAAuC;AAEjF,8DAA8D;AAC9D,IAAI,QAAQ,GAAG,CAAC,4BAA4B,EAAE;IAC5C,qBAAqB,QAAQ,GAAG,CAAC,4BAA4B;IAC7D,iBAAiB;IACjB,QAAQ,GAAG,CAAC;AACd,OAAO;IACJ,QAAQ,GAAG,CAAC;AACf;AAGA,sEAAsE;AACtE,IAAI,CAAC,oBAAoB;IACtB,MAAM,qBAAqB,iGAAA,CAAA,UAAI,CAAC,OAAO,CAAC,6BAA6B,qCAAqC;IACzG,QAAQ,GAAG,CAAC,CAAC,+CAA+C,EAAE,mBAAmB,GAAG,CAAC;IACvF,IAAI;QACF,IAAI,6FAAA,CAAA,UAAE,CAAC,UAAU,CAAC,qBAAqB;YACrC,qBAAqB,6FAAA,CAAA,UAAE,CAAC,YAAY,CAAC,oBAAoB;YACzD,iBAAiB;YAChB,QAAQ,GAAG,CAAC;QACf,OAAO;YACJ,QAAQ,GAAG,CAAC;QACf;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,CAAC,gEAAgE,EAAE,MAAM,OAAO,EAAE;QAChG,8CAA8C;QAC9C,qBAAqB,MAAM,kCAAkC;IAC/D;AACF;AAGA,4CAA4C;AAC5C,MAAM,0BAA0B;IAC9B,8EAA8E;IAC9E,IAAI,2HAAA,CAAA,UAAK,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;QACzB,kFAAkF;QAClF,OAAO,2HAAA,CAAA,UAAK,CAAC,IAAI,IAAI,gCAAgC;IACvD;IAEA,gCAAgC;IAChC,IAAI,CAAC,oBAAoB;QACtB,QAAQ,KAAK,CAAC;QACd,OAAO;IACV;IAEC,IAAI;IACJ,IAAI;QACC,iBAAiB,KAAK,KAAK,CAAC;QAC5B,qCAAqC;QACrC,IAAI,CAAC,eAAe,UAAU,IAAI,CAAC,eAAe,WAAW,IAAI,CAAC,eAAe,YAAY,EAAE;YAC3F,QAAQ,KAAK,CAAC;YACd,OAAO;QACX;IACL,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,CAAC,8DAA8D,EAAE,eAAe,EAAE,EAAE,MAAM,OAAO,EAAE;QACjH,OAAO;IACX;IAGD,QAAQ,GAAG,CAAC,CAAC,kDAAkD,EAAE,eAAe,GAAG,CAAC;IACpF,IAAI;QACF,2HAAA,CAAA,UAAK,CAAC,aAAa,CAAC;YAClB,YAAY,2HAAA,CAAA,UAAK,CAAC,UAAU,CAAC,IAAI,CAAC;QACpC;QACA,QAAQ,GAAG,CAAC,iDAAiD,0BAA0B;IACzF,EAAE,OAAO,OAAY;QACnB,oEAAoE;QACnE,QAAQ,KAAK,CAAC,CAAC,+DAA+D,EAAE,eAAe,EAAE,EAAE,MAAM,OAAO,EAAE;QAClH,2FAA2F;QAC3F,kJAAkJ;QAClJ,OAAO,MAAM,iDAAiD;IACjE;IAEA,sCAAsC;IACtC,IAAI,2HAAA,CAAA,UAAK,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;QACvB,uEAAuE;QACvE,QAAQ,GAAG,CAAC,CAAC,4CAA4C,CAAC;QAC1D,OAAO,2HAAA,CAAA,UAAK,CAAC,IAAI;IACrB;IAEA,8FAA8F;IAC9F,QAAQ,KAAK,CAAC;IACd,OAAO,MAAM,mBAAmB;AAClC;AAEA,uDAAuD;AACvD,MAAM,oBAAoB;AAE1B,6DAA6D;AAC7D,wGAAwG;AACxG,IAAI,CAAC,mBAAmB;IACrB,qFAAqF;IACrF,MAAM,IAAI,MAAM;AACnB;AAEO,MAAM,YAAY,mBACzB,iEAAiE","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/actions/list-users.ts"],"sourcesContent":["'use server';\n\nimport { adminAuth } from '@/lib/firebase/admin';\nimport type { UserRecord } from 'firebase-admin/auth';\n\n// Define return type\ninterface ListUsersResult {\n  success: boolean;\n  message: string;\n  users?: {\n    uid: string;\n    email: string | undefined; // Email might be undefined\n    creationTime: string;\n    lastSignInTime: string;\n  }[];\n}\n\nexport async function listUsersAction(): Promise<ListUsersResult> {\n  // --- Authentication/Authorization Check ---\n  // Similar to create-user action, ensure the caller is an admin.\n  // This is crucial for security. For now, we assume page-level protection.\n  // In a real app, implement robust server-side auth checks here.\n  // --- End Auth Check ---\n\n  try {\n    const listUsersResult = await adminAuth.listUsers(1000); // List up to 1000 users\n    const users = listUsersResult.users.map((userRecord: UserRecord) => ({\n        uid: userRecord.uid,\n        email: userRecord.email,\n        creationTime: userRecord.metadata.creationTime,\n        lastSignInTime: userRecord.metadata.lastSignInTime,\n    }));\n\n    return {\n      success: true,\n      message: `Successfully fetched ${users.length} users.`,\n      users: users,\n    };\n  } catch (error: any) {\n    console.error('Error listing users:', error);\n    return { success: false, message: `Erreur lors de la récupération des utilisateurs: ${error.message}` };\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;;AAeO,eAAe,uCAAa,GAAb;IACpB,6CAA6C;IAC7C,gEAAgE;IAChE,0EAA0E;IAC1E,gEAAgE;IAChE,yBAAyB;IAEzB,IAAI;QACF,MAAM,kBAAkB,MAAM,+HAAA,CAAA,YAAS,CAAC,SAAS,CAAC,OAAO,wBAAwB;QACjF,MAAM,QAAQ,gBAAgB,KAAK,CAAC,GAAG,CAAC,CAAC,aAA2B,CAAC;gBACjE,KAAK,WAAW,GAAG;gBACnB,OAAO,WAAW,KAAK;gBACvB,cAAc,WAAW,QAAQ,CAAC,YAAY;gBAC9C,gBAAgB,WAAW,QAAQ,CAAC,cAAc;YACtD,CAAC;QAED,OAAO;YACL,SAAS;YACT,SAAS,CAAC,qBAAqB,EAAE,MAAM,MAAM,CAAC,OAAO,CAAC;YACtD,OAAO;QACT;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,SAAS;YAAO,SAAS,CAAC,iDAAiD,EAAE,MAAM,OAAO,EAAE;QAAC;IACxG;AACF;;;IAzBsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 229, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA0R,GACvT,wDACA","debugId":null}},
    {"offset": {"line": 243, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAsQ,GACnS,oCACA","debugId":null}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}